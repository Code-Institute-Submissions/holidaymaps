<!DOCTYPE html>
<html>

<head>
    <title>Holiday Search</title>

    <link rel="stylesheet" href="css/bootstrap.min.css">
    <style>
        
    </style>
   
    <script>
        /** Global variables **/
        // Here we hold a collection of types (like 'church') to place
        var typeToPlace = new Map();
        
        var request = null;
        var map = null;
        var service = null;
      

        /** Get places from map by type - if over query limit pause and try once again */
        function getPlaces(map, item, type) {
            request = {
                location: item.geometry.location,
                radius: '2000',
                types: [type]
            };

            setTimeout(service.nearbySearch(request, getPlacesResults), 3200);
        };

        function getPlacesResults(results, status, pagination) {

            if (status == google.maps.places.PlacesServiceStatus.OK) {
                for (var i = 0; i < results.length; i++) {

                    for (var j = 0; j < results[i].types.length; j++) {

                        if (typeToPlace[results[i].types[j]] == null) {
                            typeToPlace[results[i].types[j]] = new Array();
                            typeToPlace[results[i].types[j]].push(results[i]);
                        } else {
                            typeToPlace[results[i].types[j]].push(results[i]);
                        }

                    }
                }
                if (pagination.hasNextPage) {
                     setTimeout(function() {
                       pagination.nextPage();
                    }, 2100);
                    
                }

            } else if (status == google.maps.GeocoderStatus.OVER_QUERY_LIMIT) {
                alert("Over Limit");

            }
        }

        var row = 0;

        function initMap() {
            

            map = new google.maps.Map(document.getElementById('map'), {
                zoom: 1,
                center: {
                    lat: -34.397,
                    lng: 150.644
                }
            });
            var geocoder = new google.maps.Geocoder();

            document.getElementById('submit').addEventListener('click', function() {
                geocodeAddress(geocoder, map);

            });

            service = new google.maps.places.PlacesService(map);
        }

        function geocodeAddress(geocoder, resultsMap) {
            var address = document.getElementById('address').value;
            geocoder.geocode({
                'address': address
            }, function(results, status) {
                if (status === 'OK') {
                    resultsMap.setCenter(results[0].geometry.location);

                    var div = document.getElementById('accomtable');
                    div.innerHTML = "";
                    div = document.getElementById('resttable');
                    div.innerHTML = "";
                    div = document.getElementById('loctable');
                    div.innerHTML = "";

                    typeToPlace = new Map();

                    map.setZoom(14);
                    $('#myModal').modal('show');
                    $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.0,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: undefined,
                                animation: true
                        
                    });
                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "amusement_park");
                       $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.08,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "8%",
                                animation: true
                        
                    });
                    }, 0);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "aquarium");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.16,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "16%",
                                animation: true
                        
                    });
                    }, 2000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "art_gallery");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.24,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "24%",
                                animation: true
                        
                    });
                    }, 4000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "church");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.32,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "32%",
                                animation: true
                        
                    });
                    }, 6000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "city_hall");
                       $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.40,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "40%",
                                animation: true
                        
                    });
                    }, 8000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "zoo");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.48,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "48%",
                                animation: true
                        
                    });
                    }, 10000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "stadium");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.56,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "56%",
                                animation: true
                        
                    });
                    }, 12000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "library");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.64,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "64%",
                                animation: true
                        
                    });
                    }, 14000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "lodging");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.72,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "72%",
                                animation: true
                        
                    });
                    }, 16000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "restaurant");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.80,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "80%",
                                animation: true
                        
                    });
                    }, 18000);

                    setTimeout(function() {
                        getPlaces(resultsMap, results[0], "bar");
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.88,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "88%",
                                animation: true
                        
                    });
                    }, 20000);

                    setTimeout(function() {
                        printRestaurantsAndBars();
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.90,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "90%",
                                animation: true
                        
                    });
                    }, 21000);
                    setTimeout(function() {
                        printAccomodations();
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 0.95,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "95%",
                                animation: true
                        
                    });
                    }, 22000);
                    setTimeout(function() {
                        printTouristAttractions();
                        $('#demo').waterbubble({
                                radius: 80,
                                lineWidth: undefined,
                                data: 1.0,
                                waterColor: 'rgba(25, 139, 201, 1)',
                                textColor: 'rgba(06, 85, 128, 0.8)',
                                font: '',
                                wave: true,
                                txt: "100%",
                                animation: true
                        
                    });
                    }, 23000);

                    setTimeout(function() {
                         $('#myModal').modal('hide');
                    }, 24000);
                   
                    
                    /*
                    var inter = window.setInterval(function() {
                        if (iterations <= 0) {
                            clearInterval(inter);

                            printTouristAttractions();
                            printAccomodations();
                            printRestaurantsAndBars();
                        } else {}
                    }, 6100);
*/
                } else {
                    alert('Geocode was not successful for the following reason: ' + status);
                }
            });
        }

        function removeDuplicates(arr, prop) {
            var obj = {};
            for (var i = 0, len = arr.length; i < len; i++) {
                if (!obj[arr[i][prop]]) obj[arr[i][prop]] = arr[i];
            }
            var newArr = [];
            for (var key in obj) newArr.push(obj[key]);
            return newArr;
        }

        function printAccomodations() {
            var myStr = "";
            row = 0;
            var div = document.getElementById('accomtable');

            var x = new Array();
            var a = typeToPlace["lodging"];
            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["lodging"][i]);
            }

            a = x;

            a = removeDuplicates(a, 'name');

            for (var i = 0; i < a.length; i++) {
                var place = a[i];

                if (row % 4 == 0) {
                    myStr += "<div class=\"row\">";
                }
                if (place.photos != null) {
                    myStr += "<div class=\"col\">";
                    myStr += "<img class=\"img-thumbnail\" src=\"" + place.photos[0].getUrl({
                        'maxWidth': 200,
                        'maxHeight': 200
                    }) + "\" >";
                    myStr += "<h5>" + place.name + "</h5>";
                    myStr += "</div>"
                    row++;
                } else {
                    myStr += "<div class=\"col\">";

                    //div.innerHTML += "<img class=\"img-thumbnail\" src=\"" + place.photos[0].getUrl({'maxWidth': 200, 'maxHeight': 200}) + "\" >";
                    myStr += "<img class=\"img-thumbnail\" src=\"" + place.icon + "\" width=\"100px\" height=\"100px\" \>";
                    myStr += "<h5>" + place.name + "</h5>";
                    myStr += "</div>";
                    row++;
                }

                if (row % 4 == 0) {
                    myStr += "</div>";
                }

                var image = {
                    url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(25, 25)
                };

                var marker = new google.maps.Marker({
                    map: map,
                    icon: image,
                    title: place.name,
                    position: place.geometry.location
                });

            }
            myStr += "</div>"
            div.innerHTML += myStr;

        }

        function printRestaurantsAndBars() {
            var myStr = "";
            row = 0;
            var div = document.getElementById('resttable');

            var x = new Array();
            var a = typeToPlace["restaurant"];
            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["restaurant"][i]);
            }

            a = typeToPlace["bar"];
            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["bar"][i]);
            }
            a = x;

            a = removeDuplicates(a, 'name');

            for (var i = 0; i < a.length; i++) {
                var place = a[i];

                if (row % 4 == 0) {
                    myStr += "<div class=\"row\">";
                }
                if (place.photos != null) {
                    myStr += "<div class=\"col\">";
                    myStr += "<img class=\"img-thumbnail\" src=\"" + place.photos[0].getUrl({
                        'maxWidth': 200,
                        'maxHeight': 200
                    }) + "\" >";
                    myStr += "<h5>" + place.name + "</h5>";
                    myStr += "</div>"
                    row++;
                } else {
                    myStr += "<div class=\"col\">";

                    //div.innerHTML += "<img class=\"img-thumbnail\" src=\"" + place.photos[0].getUrl({'maxWidth': 200, 'maxHeight': 200}) + "\" >";
                    myStr += "<img class=\"img-thumbnail\" src=\"" + place.icon + "\" width=\"100px\" height=\"100px\" \>";
                    myStr += "<h5>" + place.name + "</h5>";
                    myStr += "</div>";
                    row++;
                }

                if (row % 4 == 0) {
                    myStr += "</div>";
                }

                var image = {
                    url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(25, 25)
                };

                var marker = new google.maps.Marker({
                    map: map,
                    icon: image,
                    title: place.name,
                    position: place.geometry.location
                });

            }
            myStr += "</div>"
            div.innerHTML += myStr;

        }

        function printTouristAttractions() {

            var myStr = "";
            var div = document.getElementById('loctable');
            row = 0;

            var x = new Array();
            var a = typeToPlace["amusement_park"];
            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["amusement_park"][i]);
            }

            a = typeToPlace["aquarium"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["aquarium"][i]);
            }

            a = typeToPlace["art_gallery"];

            if (a != null) {

                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["art_gallery"][i]);
            }

            a = typeToPlace["church"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["church"][i]);
            }

            a = typeToPlace["city_hall"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["city_hall"][i]);
            }

            a = typeToPlace["courthouse"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["courthouse"][i]);
            }

            a = typeToPlace["hindu_temple"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["hindu_temple"][i]);
            }

            a = typeToPlace["zoo"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["zoo"][i]);
            }

            a = typeToPlace["synagogue"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["synagogue"][i]);
            }

            a = typeToPlace["stadium"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["stadium"][i]);
            }

            a = typeToPlace["library"];

            if (a != null) {
                for (var i = 0; i < a.length; i++)
                    x.push(typeToPlace["library"][i]);
            }

            a = x;

            a = removeDuplicates(a, 'name');
            for (var i = 0; i < a.length; i++) {
                var place = a[i];

                if (row % 4 == 0) {
                    myStr += "<div class=\"row\">";
                }
                if (place.photos != null) {
                    myStr += "<div class=\"col\">";
                    myStr += "<img class=\"img-thumbnail\" src=\"" + place.photos[0].getUrl({
                        'maxWidth': 200,
                        'maxHeight': 200
                    }) + "\" >";
                    myStr += "<h5>" + place.name + "</h5>";
                    myStr += "</div>"
                    row++;
                } else {
                    myStr += "<div class=\"col\">";

                    //div.innerHTML += "<img class=\"img-thumbnail\" src=\"" + place.photos[0].getUrl({'maxWidth': 200, 'maxHeight': 200}) + "\" >";
                    myStr += "<img class=\"img-thumbnail\" src=\"" + place.icon + "\" width=\"100px\" height=\"100px\" \>";
                    myStr += "<h5>" + place.name + "</h5>";
                    myStr += "</div>";
                    row++;
                }

                if (row % 4 == 0) {
                    myStr += "</div>";
                }

                var image = {
                    url: place.icon,
                    size: new google.maps.Size(71, 71),
                    origin: new google.maps.Point(0, 0),
                    anchor: new google.maps.Point(17, 34),
                    scaledSize: new google.maps.Size(25, 25)
                };

                var marker = new google.maps.Marker({
                    map: map,
                    icon: image,
                    title: place.name,
                    position: place.geometry.location
                });
            }
            myStr += "</div>"
            div.innerHTML += myStr;

        }
    </script>

    <script async defer src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBlb2WmxY13HJMdC19qGQ4ROUqWvZ2BKMQ&callback=initMap&libraries=places">
    </script>
    <style>
        /* Always set the map height explicitly to define the size of the div
       * element that contains the map. */
        
        #map {
            height: 60%;
        }
        /* Optional: Makes the sample page fill the window. */
        
        html,
        body {
            height: 100%;
            margin: 0;
            padding: 20px;
        }
    </style>
</head>

<body>
    <center>
        <h3>Search for your next Holiday Destination</h3></center>
    <br>
  

<!-- Modal -->
<div id="myModal" class="modal fade" style='background-color: transparent' role="dialog">
  <div class="modal-dialog" style='background-color: transparent'>

    <!-- Modal content-->
    <div class="modal-content" >
      
      <div class="modal-body text-center" style='background-color: transparent'>
        <canvas id="demo"></canvas>
      </div>
    </div>

  </div>
</div>
    <div id="searchbox">
        <input id="address" type="textbox" value="Drogheda, Ireland">
        <input id="submit" type="button" value="Search" data-toggle="modal" data-target="#myModal">
        
    </div>
    <br>
    
    <br>
       <div class="row" style="height: 100%;">
  <div class="col">
    <div id="map"></div>
  </div>
  <div class="col">
    
    <h4>Tourist Attractions</h4>
    <div class="container" id="loctable" style="width:80%">
    </div>

    <br>
    <h4>Accomodation</h4>
    <div class="container" id="accomtable" style="width:80%">
    </div>

    <br>
    <h4>Restaurants and Bars</h4>
    <div class="container" id="resttable" style="width:80%">
    </div>
    
  </div>
</div>
   




    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.3.1/jquery.min.js"></script>
    <script src="js/bootstrap.js"></script>
    <script src="bubble/waterbubble.js"></script>

</body>

</html>